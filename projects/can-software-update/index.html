<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><title>Jack Greenberg | Controller Area Network Software Update</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=title content="Jack Greenberg"><meta name=description content="The portfolio and personal website for Jack Greenberg. I'm an electrical and firmware engineer studying at Olin College of Engineering."><meta itemprop=name content="Jack Greenberg"><meta itemprop=description content="The portfolio and personal website for Jack Greenberg. I'm an electrical and firmware engineer studying at Olin College of Engineering."><meta itemprop=image content="/images/portrait_hu2ba8ed41c5e8f766e39c586334c20da3_2485738_600x0_resize_box_2.png"><meta property="og:type" content="website"><meta property="og:url" content="https://www.jackgreenberg.co"><meta property="og:title" content="Jack Greenberg"><meta property="og:description" content="The portfolio and personal website for Jack Greenberg. I'm an electrical and firmware engineer studying at Olin College of Engineering."><meta property="og:image" content="/images/portrait_hu2ba8ed41c5e8f766e39c586334c20da3_2485738_600x0_resize_box_2.png"><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://www.jackgreenberg.co"><meta property="twitter:title" content="Jack Greenberg"><meta property="twitter:description" content="The portfolio and personal website for Jack Greenberg. I'm an electrical and firmware engineer studying at Olin College of Engineering."><meta property="twitter:image" content="/images/portrait_hu2ba8ed41c5e8f766e39c586334c20da3_2485738_600x0_resize_box_2.png"><link rel=apple-touch-icon sizes=180x180 href=/favicons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicons/favicon-16x16.png><link rel=manifest href=/favicons/site.webmanifest><link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;700&family=Fira+Sans:wght@400;500;600;700&display=swap" rel=stylesheet><link rel=stylesheet href=/style.index.min.c57673b1ad49e8bf27d8e158d6a0835d4cfa6dd5f20a164edf90b9da3453ce33.min.c57673b1ad49e8bf27d8e158d6a0835d4cfa6dd5f20a164edf90b9da3453ce33.css integrity="sha256-xXZzsa1J6L8n2OFY1qCDXUz6bdXyChZO35C52jRTzjM="></head><body><div class=Page><header class="Header vertical-flex__shrink"><p class=Header__title><a href=/>Jack Greenberg</a></p><label for=nav-trigger class=nav-trigger>[]</label>
<input type=checkbox id=nav-trigger><nav class=nav><label for=nav-trigger class=nav-overlay></label><p class=nav__homelink><a href=/>Jack Greenberg</a></p><ul class=nav__list><li class=nav__list__link><a href=/projects>Projects</a></li><li class=nav__list__link><a href=/about>About</a></li><li class=nav__list__link><a href=/documents/resume.pdf>Resume</a></li></ul></nav></header><div class=vertical-flex><main class="Content vertical-flex__fill PageWidth"><div class=Content__backlink><a href=/projects>&lt; Back to projects</a></div><h1>Controller Area Network Software Update</h1><p>On Olin&rsquo;s Formula SAE team, I built a <a href=https://github.com/jack-greenberg/btldr>vehicle software update
system</a> consisting
of a custom bootloader and an application protocol that uses the CAN protocol
for its physical and data-link layer.</p><figure><a href=images/state.png><img loading=lazy sizes="(min-width: 35em) 1200px, 100vw" srcset="/projects/can-software-update/images/state_huc795d5b25902db02c434f536dafbf5a8_140432_500x0_resize_box_2.png 500w
, /projects/can-software-update/images/state_huc795d5b25902db02c434f536dafbf5a8_140432_800x0_resize_box_2.png 800w
, /projects/can-software-update/images/state_huc795d5b25902db02c434f536dafbf5a8_140432_1200x0_resize_box_2.png 1200w" src=/projects/can-software-update/images/state.png alt="State diagram for the software update system" title></a><figcaption><p>State diagram for the software update system</p></figcaption></figure><h2 id=features>Features</h2><p>The system, referred to as <em>btldr</em>, allows engineers to update any ECU on the
vehicle without physical access to the hardware. The bootloader is responsible
for initializing the CAN protocol stack and reacting to the commands issued by
the host. It also handles image validation by performing a cyclic-redunancy
check and refusing to run the image if corruption has occured.</p><p>The entire bootloader takes up less than 4 kilobytes of space on the
device, making it light-weight while still maintaining robustness.</p><h2 id=application-protocol>Application Protocol</h2><p>The <em>btldr</em> utilizes a custom protocol for initializing and conducting the
update. There are 4 different message types:</p><ul><li><strong>Ping</strong>: Checks device reachability, current firmware version, and updater
compatibility</li><li><strong>Request Update</strong>: Initialize an update session for a particular ECU</li><li><strong>Data</strong>: Contains a chunk of the binary being flashed</li><li><strong>Reset</strong>: Instructs the device to check the validity of the image and begin
executing if it is valid</li></ul><p>Each of these commands has an associated response message that is sent by the
target device to acknowledge and/or provide additional data to the host.</p><h2 id=bootloader>Bootloader</h2><p>The bootloader portion of the system is a 4 kilobyte program that executes
whenever the device resets. It first checks an EEPROM memory bank that is shared
with the application section to see if an update has been requested, and, if so,
initializes the protocol stack.</p><p>It then listens for specific CAN messages and acts according to the commands it
receives.</p><h2 id=motivation>Motivation</h2><p>Historically on the Formula team, ECU firmware updates required a group of
engineers to open up various enclosures and unplug PCBs from around the car and
manually recompile and flash code using a programming dongle. This is highly
inefficient and costs valuable time to the engineers. The motivation behind this
project is to provide a streamlined method for updating vehicle firmware that
only requires a single point of physical access to the car.</p><h2 id=future-steps>Future Steps</h2><p>Many automotive OEMs are recognizing a need for over-the-air (OTA) software
updates, especially as more and more embedded systems for electric vehicles are
being introduced for things like safety and autonomy. As a learning experiment,
I hope to integrate a Wi-Fi-based OTA updater component to the vehicle, which
would allow it to be updated remotely.</p><p>With the addition of remote access comes the necessity for security. An
unsecured software update mechanism could allow malicious actors to introduce
dangerous code to a vehicle. In addition to wireless access, I also hope to
create a secure software update system which uses code-signing to verify the
integrity and origin of the code.</p><hr><p>Detailed project documentation&mdash;including deep-dives into the different
technologies and methods used to build the tool&mdash;can be found
<a href=https://docs.olinelectricmotorsports.com/share/01350eeb-8337-4c31-98f8-7eeb97936000>here</a>.</p></main><footer class="footer vertical-flex__shrink PageWidth"><p>©2020 • v2.0 • Powered by Hugo • <a href=https://github.com/jack-greenberg/jack-greenberg.github.io>952db0c</a> • <a href=/note>Quick Note</a></p></footer></div></div></body></html>